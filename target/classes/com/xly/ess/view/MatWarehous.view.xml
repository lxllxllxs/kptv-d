<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="dtStockRecord" parent="dtMatStockRecord">
      <PropertyDef name="supplierName"/>
      <PropertyDef name="recordIdStr"/>
      <PropertyDef name="matName"/>
    </DataType>
    <DataType name="dtStockSubrecord" parent="dtMatStockSubrecord">
      <PropertyDef name="matName"/>
      <PropertyDef name="mat2Name">
        <Property name="required">true</Property>
        <Property name="submittable">true</Property>
      </PropertyDef>
      <PropertyDef name="mat3Name"/>
      <PropertyDef name="unit"/>
      <PropertyDef name="mat2Id">
        <Property name="dataType">int</Property>
      </PropertyDef>
    </DataType>
    <DataType name="dtRecord">
      <PropertyDef name="date1">
        <Property name="dataType">Date</Property>
        <Property name="displayFormat">Y-m-d</Property>
      </PropertyDef>
      <PropertyDef name="date2">
        <Property name="dataType">Date</Property>
        <Property name="displayFormat">Y-m-d</Property>
      </PropertyDef>
      <PropertyDef name="supplierName"/>
      <PropertyDef name="recordIdStr"/>
      <PropertyDef name="matName"/>
      <PropertyDef name="creater"/>
      <PropertyDef name="createDate"/>
    </DataType>
  </Model>
  <View>
    <DataSet id="dsStockRecord">
      <Property name="dataType">[dtStockRecord]</Property>
      <Property name="dataProvider">matStockService#getParentRecord</Property>
      <Property name="pageSize">40</Property>
    </DataSet>
    <DataSet id="dsStockSubrecord">
      <ClientEvent name="onCreate">&#xD;
self.set(&quot;parameter&quot;,{recordId : 0});</ClientEvent>
      <Property name="dataType">[dtStockSubrecord]</Property>
      <Property name="dataProvider">matStockService#getSubRecord</Property>
    </DataSet>
    <DataSet id="dsMat1">
      <Property name="dataType">[dtMat]</Property>
      <Property name="dataProvider">matService#getAllMat</Property>
    </DataSet>
    <DataSet id="dsMat1ToMat2">
      <ClientEvent name="beforeLoadData" signature="self,arg,dsMat1">&#xD;
var matId = view.get(&quot;#dsMat1.data:#.#matId&quot;);&#xD;
&#xD;
self.set(&quot;parameter&quot;,{&#xD;
	&quot;matId&quot;:matId&#xD;
});&#xD;
</ClientEvent>
      <Property name="dataType">[dtMat2]</Property>
      <Property name="dataProvider">matService#getMat1ToMat2</Property>
    </DataSet>
    <DataSet id="dsMat3">
      <ClientEvent name="beforeLoadData" signature="self,arg,dsMat1ToMat2">var mat2Id = view.get(&quot;#dsMat1ToMat2.data:#.#mat2Id&quot;);&#xD;
self.set(&quot;parameter&quot;,{mat2Id : mat2Id});</ClientEvent>
      <Property name="dataType">[dtMat3]</Property>
      <Property name="dataProvider">matService#getMat3ByMat2</Property>
    </DataSet>
    <DataSet id="dsRecordSave">
      <Property name="dataType">dtStockRecord</Property>
    </DataSet>
    <DataSet id="dsSubrecordSave">
      <Property name="dataType">[dtStockSubrecord]</Property>
    </DataSet>
    <DataSet id="dsSupplier">
      <Property name="dataType">[dtMatSupplier]</Property>
      <Property name="dataProvider">matSupplierService#getSupplier</Property>
    </DataSet>
    <DataSet id="dsFreightBill">
      <Property name="dataType">dtMatFreightBill</Property>
    </DataSet>
    <DataSet id="dsSubrecordEdit">
      <ClientEvent name="onCreate">&#xD;
self.set(&quot;parameter&quot;,{recordId : 0});</ClientEvent>
      <Property name="dataType">[dtStockSubrecord]</Property>
      <Property name="dataProvider">matStockService#getSubRecord</Property>
    </DataSet>
    <DataSet id="dsFreightEdit">
      <ClientEvent name="onCreate">self.setData({&#xD;
	$dataType : &quot;dsFreightEdit&quot;,&#xD;
}&#xD;
);</ClientEvent>
      <Property name="dataType">dtMatFreightBill</Property>
      <Property name="dataProvider">matStockService#getFreight</Property>
      <Property name="readOnly">true</Property>
    </DataSet>
    <DataSetDropDown id="dsddMat1">
      <Property name="dataSet">dsMat1</Property>
      <Property name="property">matName</Property>
      <Property name="displayProperty">matName</Property>
      <Property name="useEmptyItem">true</Property>
      <Property name="assignmentMap">matId</Property>
      <Property name="autoOpen">true</Property>
      <Property name="editable">false</Property>
    </DataSetDropDown>
    <DataSetDropDown id="wkgdsddMat1">
      <ClientEvent name="onValueSelect" signature="self,arg,dsMat1,dsSubrecordSave">&#xD;
var matId = view.get(&quot;#dsMat1.data:#.#matId&quot;);&#xD;
dsSubrecordSave.clear();&#xD;
dsSubrecordSave.insert({&#xD;
	$dataType : &quot;dsSubrecordSave&quot;,&#xD;
&#xD;
}&#xD;
);&#xD;
if(matId==1){//材料&#xD;
    view.get(&quot;#price&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#applicant&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#btnAddFreight&quot;).set(&quot;visible&quot;,false);&#xD;
}else if(matId==2 || matId==3){//釉料、加工料&#xD;
	view.get(&quot;#price&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#applicant&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#btnAddFreight&quot;).set(&quot;visible&quot;,false);&#xD;
}else {&#xD;
	view.get(&quot;#price&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#applicant&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#btnAddFreight&quot;).set(&quot;visible&quot;,true);&#xD;
}&#xD;
&#xD;
</ClientEvent>
      <Property name="dataSet">dsMat1</Property>
      <Property name="property">matName</Property>
      <Property name="displayProperty">matName</Property>
      <Property name="useEmptyItem">true</Property>
      <Property name="assignmentMap">matId</Property>
      <Property name="autoOpen">true</Property>
      <Property name="editable">false</Property>
    </DataSetDropDown>
    <DataSetDropDown id="wkgdsddMat2">
      <Property name="property">mat2Name</Property>
      <Property name="displayProperty">mat2Name</Property>
      <Property name="dataSet">dsMat1ToMat2</Property>
      <Property name="assignmentMap">mat2Id</Property>
      <Property name="autoOpen">true</Property>
      <Property name="editable">false</Property>
      <Property name="useEmptyItem">false</Property>
      <Property name="reloadDataOnOpen">true</Property>
    </DataSetDropDown>
    <DataSetDropDown id="wkgdsddMat3">
      <Property name="dataSet">dsMat3</Property>
      <Property name="displayProperty">mat3Name</Property>
      <Property name="property">mat3Name</Property>
      <Property name="editable">false</Property>
      <Property name="autoOpen">true</Property>
      <Property name="assignmentMap">mat3Id</Property>
      <Property name="reloadDataOnOpen">true</Property>
    </DataSetDropDown>
    <ListDropDown id="lddReview">
      <Property name="items">
        <Collection>
          <Entity>
            <Property name="key">0</Property>
            <Property name="value">未审核</Property>
          </Entity>
          <Entity>
            <Property name="key">1</Property>
            <Property name="value">审核通过</Property>
          </Entity>
          <Entity>
            <Property name="key">2</Property>
            <Property name="value">审核不通过</Property>
          </Entity>
        </Collection>
      </Property>
      <Property name="displayProperty">value</Property>
      <Property name="assignmentMap">reviewState=key</Property>
      <Property name="property">value</Property>
      <Property name="useEmptyItem">true</Property>
    </ListDropDown>
    <ListDropDown id="lddCheck">
      <Property name="items">
        <Collection>
          <Entity>
            <Property name="key">0</Property>
            <Property name="value">未化验</Property>
          </Entity>
          <Entity>
            <Property name="key">1</Property>
            <Property name="value">化验通过</Property>
          </Entity>
          <Entity>
            <Property name="key">2</Property>
            <Property name="value">化验不通过</Property>
          </Entity>
          <Entity>
            <Property name="key">3</Property>
            <Property name="value">无需化验</Property>
          </Entity>
        </Collection>
      </Property>
      <Property name="displayProperty">value</Property>
      <Property name="assignmentMap">checkState=key</Property>
      <Property name="property">value</Property>
      <Property name="useEmptyItem">true</Property>
    </ListDropDown>
    <DataSetDropDown id="dsddSupplier">
      <Property name="dataSet">dsSupplier</Property>
      <Property name="property">supplierName</Property>
      <Property name="displayProperty">supplierName</Property>
      <Property name="assignmentMap">supplierId=id</Property>
      <Property name="autoOpen">true</Property>
      <Property name="editable">false</Property>
    </DataSetDropDown>
    <ListDropDown id="lddAccount">
      <Property name="items">许红宇,马泽卿</Property>
      <Property name="useEmptyItem">false</Property>
    </ListDropDown>
    <SplitPanel>
      <Property name="direction">bottom</Property>
      <Property name="position">320</Property>
      <MainControl>
        <Container layout="vbox">
          <AutoForm id="afRecord">
            <Property name="cols">*,*,*,*,*</Property>
            <Property name="labelSpacing">:</Property>
            <Property name="labelAlign">right</Property>
            <Property name="dataType">dtRecord</Property>
            <Property name="createPrivateDataSet">true</Property>
            <AutoFormElement>
              <Property name="name">recordIdStr</Property>
              <Property name="property">recordIdStr</Property>
              <Property name="label">票号</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">matName</Property>
              <Property name="property">matName</Property>
              <Property name="label">组名</Property>
              <Property name="trigger">wkgdsddMat1</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">supplierName</Property>
              <Property name="property">supplierName</Property>
              <Property name="label">供应商</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">creater</Property>
              <Property name="property">creater</Property>
              <Property name="label">入库员</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">createDate</Property>
              <Property name="property">createDate</Property>
              <Property name="label">入库时间</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">date1</Property>
              <Property name="property">date1</Property>
              <Property name="label">时间区间</Property>
              <Property name="trigger">defaultDateDropDown</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">date2</Property>
              <Property name="property">date2</Property>
              <Property name="label">至</Property>
              <Property name="trigger">defaultDateDropDown</Property>
              <Editor/>
            </AutoFormElement>
          </AutoForm>
          <ToolBar>
            <DataPilot>
              <Property name="dataSet">dsStockRecord</Property>
              <Property name="itemCodes">pages,pageSize</Property>
            </DataPilot>
            <ToolBarButton id="btnQuery">
              <ClientEvent name="onClick" signature="self,arg,afRecord,dsStockRecord">//获取afCondition绑定的实体对象&#xD;
var entity = afRecord.get(&quot;entity&quot;);&#xD;
var recordIdStr=entity.get(&quot;recordIdStr&quot;);&#xD;
var matName=entity.get(&quot;matName&quot;);&#xD;
var supplierName=entity.get(&quot;supplierName&quot;);&#xD;
var creater=entity.get(&quot;creater&quot;);&#xD;
var createDate=entity.get(&quot;createDate&quot;);&#xD;
&#xD;
var date1=entity.get(&quot;date1&quot;);&#xD;
var date2=entity.get(&quot;date2&quot;);&#xD;
&#xD;
if(date1==null || date2==null){&#xD;
        dsStockRecord.set(&quot;parameter&quot;,entity).flushAsync();&#xD;
}else{&#xD;
date1=date1.formatDate(&quot;Y-m-d&quot;);&#xD;
date2=date2.formatDate(&quot;Y-m-d&quot;);&#xD;
if(date1&lt;date2){&#xD;
&#xD;
	//将实体对象作为参数传入，并异步刷新&#xD;
    dsStockRecord.set(&quot;parameter&quot;,{&quot;date1&quot;:date1,&#xD;
	&quot;date2&quot;:date2,&#xD;
	&quot;recordIdStr&quot;:recordIdStr,&#xD;
	&quot;matName&quot;:matName,&#xD;
	&quot;supplierName&quot;:supplierName,&#xD;
	&quot;creater&quot;:creater,&#xD;
	&quot;createDate&quot;:createDate&#xD;
	}).flushAsync();&#xD;
}else{&#xD;
	dorado.MessageBox.alert(&quot;时间区间有误，请重新选择！&quot;);&#xD;
}&#xD;
&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
              <Property name="caption">查询</Property>
              <Property name="icon"> url(>skin>common/icons.gif) -20px -40px</Property>
            </ToolBarButton>
            <ToolBarButton id="btnAdd">
              <ClientEvent name="onClick" signature="self,arg,dialogAdd,dsRecordSave,dsSubrecordSave">&#xD;
dsSubrecordSave.insert({&#xD;
	$dataType : &quot;dsSubrecordSave&quot;,&#xD;
&#xD;
}&#xD;
);&#xD;
dsRecordSave.setData({&#xD;
	$dataType : &quot;dsRecordSave&quot;,&#xD;
&#xD;
}&#xD;
);&#xD;
view.get(&quot;#afFreightBill&quot;).set(&quot;visible&quot;,false);&#xD;
view.get(&quot;#btnAddFreight&quot;).set(&quot;visible&quot;,false);&#xD;
dialogAdd.show();&#xD;
</ClientEvent>
              <Property name="caption">新增</Property>
              <Property name="icon"> url(>skin>common/icons.gif) -120px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="btnEdit">
              <ClientEvent name="onClick" signature="self,arg,dialogEdit,dsRecordSave,dsSubrecordEdit,dsStockRecord,dsFreightEdit">var entity = dsStockRecord.get(&quot;data:#&quot;);&#xD;
var matId = view.get(&quot;#dsStockRecord.data:#.#matId&quot;);&#xD;
var state = view.get(&quot;#dsStockRecord.data:#.#state&quot;);&#xD;
&#xD;
var recordId = view.get(&quot;#dsStockRecord.data:#.#recordId&quot;);&#xD;
var matName = view.get(&quot;#dsStockRecord.data:#.#matName&quot;);&#xD;
var supplierName = view.get(&quot;#dsStockRecord.data:#.#supplierName&quot;);&#xD;
var supplierId = view.get(&quot;#dsStockRecord.data:#.#supplierId&quot;);&#xD;
var recordId = view.get(&quot;#dsStockRecord.data:#.#recordId&quot;);&#xD;
&#xD;
dsRecordSave.setData({&#xD;
	$dataType : &quot;dsRecordSave&quot;,&#xD;
        matId : matId,&#xD;
	recordId : recordId,&#xD;
	matName : matName,&#xD;
	supplierName : supplierName,&#xD;
	supplierId : supplierId&#xD;
}&#xD;
);&#xD;
//将实体对象作为参数传入，并异步刷新&#xD;
dsSubrecordEdit.set(&quot;parameter&quot;,{recordId : recordId}).flushAsync();&#xD;
&#xD;
&#xD;
if(matId==1){&#xD;
	view.get(&quot;#afFreightBillEdit&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#priceEdit&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#applicantEdit&quot;).set(&quot;visible&quot;,true);&#xD;
}else if(matId==2 || matId==3){//釉料、加工料&#xD;
	view.get(&quot;#priceEdit&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#applicantEdit&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#afFreightBillEdit&quot;).set(&quot;visible&quot;,false);&#xD;
}else{&#xD;
	//获取运费记录&#xD;
	dsFreightEdit.set(&quot;parameter&quot;,{recordId : recordId}).flushAsync();&#xD;
	view.get(&quot;#afFreightBillEdit&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#priceEdit&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#applicantEdit&quot;).set(&quot;visible&quot;,false);&#xD;
}&#xD;
&#xD;
if(matId==1 || matId==2 || matId==3){//材料、釉料、加工料&#xD;
    if(state==4){//等待审核&#xD;
		dialogEdit.show();&#xD;
	}else{&#xD;
	    dorado.MessageBox.alert(&quot;该记录不能修改！&quot;); &#xD;
    }&#xD;
}else if(matId==4 || matId==5){//煤、包装物&#xD;
    if(state==3){//等待填价&#xD;
		dialogEdit.show();&#xD;
	}else{&#xD;
	    dorado.MessageBox.alert(&quot;该记录不能修改！&quot;); &#xD;
    }&#xD;
}else if(matId==6 || matId==7){//坯料、化工原料&#xD;
	if(state==0){//等待化验&#xD;
		dialogEdit.show();&#xD;
	}else{&#xD;
	    dorado.MessageBox.alert(&quot;该记录不能修改！&quot;); &#xD;
    }&#xD;
}else{&#xD;
	dorado.MessageBox.alert(&quot;该记录不能修改！&quot;); &#xD;
}</ClientEvent>
              <Property name="caption">修改</Property>
              <Property name="icon"> url(>skin>common/icons.gif) -200px -0px</Property>
            </ToolBarButton>
            <ToolBarButton id="btnDel">
              <ClientEvent name="onClick" signature="self,arg,dsStockRecord,dialogDel">var entity = dsStockRecord.get(&quot;data:#&quot;);&#xD;
var matId = view.get(&quot;#dsStockRecord.data:#.#matId&quot;);&#xD;
var state = view.get(&quot;#dsStockRecord.data:#.#state&quot;);&#xD;
&#xD;
&#xD;
var createDate = view.get(&quot;#dsStockRecord.data:#.#createDate&quot;).formatDate(&quot;Y-m-d&quot;);&#xD;
&#xD;
&#xD;
if(entity){&#xD;
    dorado.MessageBox.confirm(&quot;确认要删除记录吗？&quot;, function(){&#xD;
		var date = new Date();&#xD;
		var strYear = date.getYear()+1900;&#xD;
		var month = date.getMonth() + 1;&#xD;
                var strDate = date.getDate();&#xD;
		var pYear = createDate.substring(0,4);&#xD;
		var pMonth = createDate.substring(5,7);&#xD;
                var pDate = createDate.substring(8,10);&#xD;
&#xD;
		if(parseInt(pYear) == parseInt(strYear) &amp;&amp; (parseInt(month) - parseInt(pMonth)&lt;2)){&#xD;
			if(parseInt(month) - parseInt(pMonth) == 1 &amp;&amp; parseInt(strDate)>8){&#xD;
				dorado.MessageBox.alert(&quot;该记录不能删除！&quot;);&#xD;
		        }else{&#xD;
		        //能删除&#xD;
				if(matId==1 || matId==2 || matId==3){//材料、釉料、加工料&#xD;
                   if(state==4){//等待审核&#xD;
		           dialogDel.show();&#xD;
	               }else{&#xD;
	                  dorado.MessageBox.alert(&quot;该记录不能删除！&quot;); &#xD;
                   }&#xD;
               }else if(matId==4 || matId==5){//煤、包装物&#xD;
                   if(state==3){//等待填价&#xD;
	               	dialogDel.show();&#xD;
	               }else{&#xD;
	                   dorado.MessageBox.alert(&quot;该记录不能删除！&quot;); &#xD;
                   }&#xD;
               }else if(matId==6 || matId==7){//坯料、化工原料&#xD;
	               if(state==0){//等待化验&#xD;
	               	dialogDel.show();&#xD;
	               }else{&#xD;
	                   dorado.MessageBox.alert(&quot;该记录不能删除！&quot;); &#xD;
                   }&#xD;
               }else{&#xD;
               	  dorado.MessageBox.alert(&quot;该记录不能删除！&quot;); &#xD;
               }&#xD;
&#xD;
		             &#xD;
		        }&#xD;
		}else{&#xD;
			dorado.MessageBox.alert(&quot;该记录不能删除！&quot;);&#xD;
		}&#xD;
		&#xD;
       &#xD;
    })&#xD;
}</ClientEvent>
              <Property name="caption">删除并保存</Property>
              <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
            </ToolBarButton>
          </ToolBar>
          <DataGrid id="dgStockRecord">
            <ClientEvent name="onDataRowClick" signature="self,arg,dsStockSubrecord,dsStockRecord">var entity = dsStockRecord.get(&quot;data:#&quot;);&#xD;
if (entity) {&#xD;
			&#xD;
     var recordId  = entity.get(&quot;recordId&quot;);&#xD;
                 &#xD;
     //将实体对象作为参数传入，并异步刷新&#xD;
     dsStockSubrecord.set(&quot;parameter&quot;,{recordId : recordId}).flushAsync();&#xD;
}</ClientEvent>
            <Property name="dataSet">dsStockRecord</Property>
            <Property name="readOnly">true</Property>
            <DataColumn name="recordIdStr">
              <Property name="property">recordIdStr</Property>
              <Property name="align">center</Property>
              <Property name="caption">票号</Property>
            </DataColumn>
            <DataColumn name="matName">
              <Property name="property">matName</Property>
              <Property name="align">center</Property>
              <Property name="caption">组名</Property>
            </DataColumn>
            <DataColumn name="supplierName">
              <Property name="property">supplierName</Property>
              <Property name="align">center</Property>
              <Property name="caption">供应商</Property>
            </DataColumn>
            <DataColumn name="totalPrice">
              <Property name="property">totalPrice</Property>
              <Property name="align">center</Property>
              <Property name="caption">总金额</Property>
            </DataColumn>
            <DataColumn name="creater">
              <Property name="property">creater</Property>
              <Property name="align">center</Property>
              <Property name="caption">入库员</Property>
            </DataColumn>
            <DataColumn name="createDate">
              <Property name="property">createDate</Property>
              <Property name="align">center</Property>
              <Property name="caption">入库时间</Property>
            </DataColumn>
            <DataColumn>
              <Property name="name">state</Property>
              <Property name="property">state</Property>
              <Property name="align">center</Property>
              <Property name="caption">状态</Property>
              <Editor/>
            </DataColumn>
          </DataGrid>
          <Dialog id="dialogAdd">
            <ClientEvent name="onHide" signature="self,arg,dsSubrecordSave,dsRecordSave">dsSubrecordSave.clear();&#xD;
dsRecordSave.clear();</ClientEvent>
            <Property name="caption">添加入库信息</Property>
            <Property name="width">800</Property>
            <Property name="height">600</Property>
            <Buttons>
              <Button id="aBtnSave">
                <ClientEvent name="onClick" signature="self,arg,dialogAdd,updateactionSave,dsSubrecordSave,dsRecordSave,afParentRecord,dsFreightBill">&#xD;
afParentRecord.validate();&#xD;
//在保存操作完成后的回调函数中将编辑弹出框隐藏&#xD;
updateactionSave.execute(function(){&#xD;
	dsRecordSave.clear();&#xD;
	dsSubrecordSave.clear();&#xD;
	dsFreightBill.clear();&#xD;
    dialogAdd.hide();&#xD;
&#xD;
})</ClientEvent>
                <Property name="caption">保存</Property>
                <Property name="icon">url(>skin>common/icons.gif) -140px -20px</Property>
              </Button>
              <Button id="aBtnCancel">
                <ClientEvent name="onClick" signature="self,arg,dialogAdd,dsSubrecordSave,dsRecordSave">dialogAdd.hide();&#xD;
dsSubrecordSave.clear();&#xD;
dsRecordSave.clear();</ClientEvent>
                <Property name="caption">取消</Property>
                <Property name="icon">url(>skin>common/icons.gif) -280px -220px</Property>
              </Button>
            </Buttons>
            <Children>
              <AutoForm id="afParentRecord">
                <Property name="cols">*,*,*</Property>
                <Property name="readOnly">false</Property>
                <Property name="createPrivateDataSet">false</Property>
                <Property name="dataSet">dsRecordSave</Property>
                <AutoFormElement>
                  <Property name="name">matName</Property>
                  <Property name="property">matName</Property>
                  <Property name="trigger">wkgdsddMat1</Property>
                  <Property name="label">组名</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">supplierName</Property>
                  <Property name="property">supplierName</Property>
                  <Property name="trigger">dsddSupplier</Property>
                  <Property name="label">供应商</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
              <ToolBar>
                <ToolBarButton id="btnSubAdd">
                  <ClientEvent name="onClick" signature="self,arg,dsSubrecordSave">&#xD;
dsSubrecordSave.insert({&#xD;
	$dataType : &quot;dsSubrecordSave&quot;,&#xD;
&#xD;
}&#xD;
);&#xD;
&#xD;
</ClientEvent>
                  <Property name="caption">增加</Property>
                  <Property name="icon"> url(>skin>common/icons.gif) -120px -0px</Property>
                </ToolBarButton>
                <ToolBarButton id="btnSubDelet">
                  <ClientEvent name="onClick" signature="self,arg,dsSubrecordSave">var entity = view.get(&quot;#dsSubrecordSave.data:#&quot;);&#xD;
entity.remove();&#xD;
&#xD;
</ClientEvent>
                  <Property name="caption">删除</Property>
                  <Property name="icon"> url(>skin>common/icons.gif) -140px -0px</Property>
                </ToolBarButton>
                <ToolBarButton id="btnAddFreight">
                  <ClientEvent name="onClick" signature="self,arg,dsFreightBill,afFreightBill,dsFreightBill">var visible=view.get(&quot;#afFreightBill&quot;).get(&quot;visible&quot;);&#xD;
if(visible){&#xD;
	view.get(&quot;#afFreightBill&quot;).set(&quot;visible&quot;,false);&#xD;
}else{&#xD;
	view.get(&quot;#afFreightBill&quot;).set(&quot;visible&quot;,true);&#xD;
	dsFreightBill.setData({&#xD;
	$dataType : &quot;dsFreightBill&quot;,&#xD;
       });&#xD;
}&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
</ClientEvent>
                  <Property name="caption">增加运费单</Property>
                  <Property name="icon"> url(>skin>common/icons.gif) -60px -120px</Property>
                  <Property name="visible">false</Property>
                </ToolBarButton>
              </ToolBar>
              <DataGrid id="dgSubrecordSave">
                <Property name="dataSet">dsSubrecordSave</Property>
                <Property name="readOnly">false</Property>
                <Property name="height">250</Property>
                <Property name="selectionMode">none</Property>
                <Property name="dynaRowHeight">false</Property>
                <DataColumn name="mat2Name">
                  <Property name="property">mat2Name</Property>
                  <Property name="trigger">wkgdsddMat2</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">类别</Property>
                </DataColumn>
                <DataColumn name="mat3Name">
                  <Property name="property">mat3Name</Property>
                  <Property name="trigger">wkgdsddMat3</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">品名</Property>
                </DataColumn>
                <DataColumn name="count">
                  <Property name="property">count</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">数量</Property>
                </DataColumn>
                <DataColumn id="price" name="price">
                  <Property name="property">price</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">单价</Property>
                </DataColumn>
                <DataColumn id="applicant" name="applicant">
                  <Property name="property">applicant</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">申请人</Property>
                </DataColumn>
              </DataGrid>
              <AutoForm id="afFreightBill">
                <Property name="cols">*,*,*</Property>
                <Property name="readOnly">false</Property>
                <Property name="createPrivateDataSet">false</Property>
                <Property name="dataSet">dsFreightBill</Property>
                <Property name="visible">false</Property>
                <AutoFormElement>
                  <Property name="name">account</Property>
                  <Property name="property">account</Property>
                  <Property name="label">挂账</Property>
                  <Property name="trigger">lddAccount</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">freightUnit</Property>
                  <Property name="property">freightUnit</Property>
                  <Property name="label">单价</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">driver</Property>
                  <Property name="property">driver</Property>
                  <Property name="label">司机名</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">driverPhone</Property>
                  <Property name="property">driverPhone</Property>
                  <Property name="label">司机电话</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">plateNum</Property>
                  <Property name="property">plateNum</Property>
                  <Property name="label">车牌号</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">unloadFee</Property>
                  <Property name="property">unloadFee</Property>
                  <Property name="label">卸车费</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">cleanFee</Property>
                  <Property name="property">cleanFee</Property>
                  <Property name="label">清理费</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">compensation</Property>
                  <Property name="property">compensation</Property>
                  <Property name="label">赔偿</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
            </Children>
            <Tools/>
          </Dialog>
          <UpdateAction id="updateactionSave">
            <ClientEvent name="onFailure"> </ClientEvent>
            <ClientEvent name="onSuccess" signature="self,arg,dsStockRecord,dsStockSubrecord">var info = self.get(&quot;returnValue&quot;);&#xD;
if(info.result){&#xD;
	dsStockRecord.flush();&#xD;
	dsStockSubrecord.flush();&#xD;
	//dorado.MessageBox.alert(info.message);&#xD;
}else{&#xD;
	dorado.MessageBox.alert(info.message, {&#xD;
    icon: &quot;WARNING&quot;&#xD;
});&#xD;
}&#xD;
&#xD;
 </ClientEvent>
            <ClientEvent name="onGetUpdateData" signature="self,arg,dsRecordSave,dsSubrecordSave,dsFreightBill">var supplierId = view.get(&quot;#dsRecordSave.data:#.#supplierId&quot;);&#xD;
var matId = view.get(&quot;#dsRecordSave.data:#.#matId&quot;);&#xD;
&#xD;
//运费单信息&#xD;
var driver = view.get(&quot;#dsFreightBill.data:#.#driver&quot;);&#xD;
var freightUnit = view.get(&quot;#dsFreightBill.data:#.#freightUnit&quot;);&#xD;
&#xD;
var weight = view.get(&quot;#dsSubrecordSave.data:#.#count&quot;);&#xD;
var unloadFee = view.get(&quot;#dsFreightBill.data:#.#unloadFee&quot;);&#xD;
var cleanFee = view.get(&quot;#dsFreightBill.data:#.#cleanFee&quot;);&#xD;
var compensation = view.get(&quot;#dsFreightBill.data:#.#compensation&quot;);&#xD;
var account = view.get(&quot;#dsFreightBill.data:#.#account&quot;);&#xD;
var driverPhone = view.get(&quot;#dsFreightBill.data:#.#driverPhone&quot;);&#xD;
var plateNum = view.get(&quot;#dsFreightBill.data:#.#plateNum&quot;);&#xD;
//dorado.MessageBox.alert(driver);&#xD;
self.set(&quot;parameter&quot;,{&#xD;
	&quot;supplierId&quot;:supplierId,&#xD;
	&quot;matId&quot; : matId,&#xD;
	&quot;driver&quot; : driver,&#xD;
	&quot;freightUnit&quot; : freightUnit,&#xD;
	&quot;weight&quot; : weight,&#xD;
	&quot;unloadFee&quot; : unloadFee,&#xD;
	&quot;cleanFee&quot; : cleanFee, &#xD;
	&quot;compensation&quot; : compensation,&#xD;
	&quot;account&quot; : account,&#xD;
	&quot;driverPhone&quot; : driverPhone, &#xD;
	&quot;plateNum&quot; : plateNum&#xD;
});</ClientEvent>
            <Property name="executingMessage">正在保存。。。</Property>
            <Property name="hotkey">ctrl+s</Property>
            <Property name="dataResolver">matStockService#saveMatStockRecord</Property>
            <UpdateItem>
              <Property name="dataSet">dsSubrecordSave</Property>
            </UpdateItem>
          </UpdateAction>
          <AjaxAction id="ajaxActionDel">
            <ClientEvent name="onSuccess" signature="self,arg,dsStockRecord,dsStockSubrecord">var entity = dsStockRecord.get(&quot;data:#&quot;);&#xD;
&#xD;
//获取返回值&#xD;
var rtv = self.get(&quot;returnValue&quot;);&#xD;
//根据返回值判断&#xD;
if(rtv.result){&#xD;
      //dorado.MessageBox.alert(rtv.message);&#xD;
	entity.remove();&#xD;
	//刷新数据&#xD;
	dsStockRecord.flush();&#xD;
	dsStockSubrecord.clear();&#xD;
}else{&#xD;
    dorado.MessageBox.alert(rtv.message,{title:&quot;提示&quot;,icon:&quot;WARNING&quot;});&#xD;
}</ClientEvent>
            <Property name="service">matStockService#deletMatRecord</Property>
            <Property name="executingMessage">正在删除</Property>
          </AjaxAction>
          <Dialog id="dialogDel">
            <Property name="caption">填写信息</Property>
            <Property name="width">300</Property>
            <Property name="height">200</Property>
            <Property name="closeAction">hide</Property>
            <Buttons>
              <Button id="dBtnSave">
                <ClientEvent name="onClick" signature="self,arg,dialogDel,dsStockRecord,ajaxActionDel">&#xD;
var recordId = view.get(&quot;#dsStockRecord.data:#.#recordId&quot;);&#xD;
&#xD;
var entity1 = view.get(&quot;#afDrop.entity&quot;);&#xD;
var reason = entity1.get(&quot;reason&quot;);&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
   // 将参数拼装成JSON形式&#xD;
                var parameter = {&#xD;
                    recordId: recordId,&#xD;
	            reason: reason&#xD;
                };&#xD;
   // 调用AjaxAction&#xD;
    ajaxActionDel.set(&quot;parameter&quot;, parameter).execute(function(){&#xD;
        dialogDel.hide();&#xD;
   });</ClientEvent>
                <Property name="caption">确定</Property>
                <Property name="icon">url(>skin>common/icons.gif) -140px -20px</Property>
              </Button>
              <Button id="dBtnCancel">
                <ClientEvent name="onClick" signature="self,arg,dialogDel">&#xD;
dialogDel.hide();</ClientEvent>
                <Property name="caption">取消</Property>
                <Property name="icon">url(>skin>common/icons.gif) -280px -220px</Property>
              </Button>
            </Buttons>
            <Children>
              <AutoForm id="afDrop">
                <Property name="readOnly">false</Property>
                <Property name="createPrivateDataSet">true</Property>
                <Property name="labelWidth">70</Property>
                <Property name="labelSeparator">:</Property>
                <Property name="cols">*</Property>
                <AutoFormElement>
                  <Property name="name">reason</Property>
                  <Property name="label">删除原因</Property>
                  <Property name="property">reason</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
            </Children>
            <Tools/>
          </Dialog>
          <Dialog id="dialogEdit">
            <ClientEvent name="onHide" signature="self,arg,dsSubrecordSave,dsRecordSave">dsSubrecordSave.clear();&#xD;
dsRecordSave.clear();</ClientEvent>
            <Property name="caption">修改入库信息</Property>
            <Property name="width">800</Property>
            <Property name="height">600</Property>
            <Buttons>
              <Button id="eBtnSave">
                <ClientEvent name="onClick" signature="self,arg,dialogEdit,updateactionEdit,afParentEdit,dsFreightBill,dsSubrecordEdit,dsRecordSave,dsFreightEdit">&#xD;
afParentEdit.validate();&#xD;
//在保存操作完成后的回调函数中将编辑弹出框隐藏&#xD;
updateactionEdit.execute(function(){&#xD;
	dsRecordSave.clear();&#xD;
	dsSubrecordEdit.clear();&#xD;
	dsFreightEdit.clear();&#xD;
    dialogEdit.hide();&#xD;
&#xD;
})</ClientEvent>
                <Property name="caption">保存</Property>
                <Property name="icon">url(>skin>common/icons.gif) -140px -20px</Property>
              </Button>
              <Button id="eBtnCancel">
                <ClientEvent name="onClick" signature="self,arg,dialogEdit,dsSubrecordSave,dsRecordSave">dialogEdit.hide();&#xD;
dsSubrecordSave.clear();&#xD;
dsRecordSave.clear();</ClientEvent>
                <Property name="caption">取消</Property>
                <Property name="icon">url(>skin>common/icons.gif) -280px -220px</Property>
              </Button>
            </Buttons>
            <Children>
              <AutoForm id="afParentEdit">
                <Property name="cols">*,*,*</Property>
                <Property name="readOnly">true</Property>
                <Property name="createPrivateDataSet">false</Property>
                <Property name="dataSet">dsRecordSave</Property>
                <AutoFormElement>
                  <Property name="name">matName</Property>
                  <Property name="property">matName</Property>
                  <Property name="label">组名</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">supplierName</Property>
                  <Property name="property">supplierName</Property>
                  <Property name="label">供应商</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
              <ToolBar>
                <ToolBarButton id="btnSubAddE">
                  <ClientEvent name="onClick" signature="self,arg,dsSubrecordSave">&#xD;
dsSubrecordSave.insert({&#xD;
	$dataType : &quot;dsSubrecordSave&quot;,&#xD;
&#xD;
}&#xD;
);&#xD;
&#xD;
</ClientEvent>
                  <Property name="caption">增加</Property>
                  <Property name="icon"> url(>skin>common/icons.gif) -120px -0px</Property>
                </ToolBarButton>
                <ToolBarButton id="btnSubDeletE">
                  <ClientEvent name="onClick" signature="self,arg,dsSubrecordSave">var entity = view.get(&quot;#dsSubrecordSave.data:#&quot;);&#xD;
entity.remove();&#xD;
&#xD;
</ClientEvent>
                  <Property name="caption">删除</Property>
                  <Property name="icon"> url(>skin>common/icons.gif) -140px -0px</Property>
                </ToolBarButton>
              </ToolBar>
              <DataGrid id="dgSubrecordEdit">
                <Property name="dataSet">dsSubrecordEdit</Property>
                <Property name="readOnly">false</Property>
                <Property name="height">250</Property>
                <Property name="selectionMode">none</Property>
                <Property name="dynaRowHeight">false</Property>
                <DataColumn name="mat2Name">
                  <Property name="property">mat2Name</Property>
                  <Property name="trigger">wkgdsddMat2</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">类别</Property>
                </DataColumn>
                <DataColumn name="mat3Name">
                  <Property name="property">mat3Name</Property>
                  <Property name="trigger">wkgdsddMat3</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">品名</Property>
                </DataColumn>
                <DataColumn name="count">
                  <Property name="property">count</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">数量</Property>
                </DataColumn>
                <DataColumn id="priceEdit" name="price">
                  <Property name="property">price</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">单价</Property>
                </DataColumn>
                <DataColumn id="applicantEdit" name="applicant">
                  <Property name="property">applicant</Property>
                  <Property name="align">center</Property>
                  <Property name="caption">申请人</Property>
                </DataColumn>
              </DataGrid>
              <AutoForm id="afFreightBillEdit">
                <Property name="cols">*,*,*</Property>
                <Property name="readOnly">true</Property>
                <Property name="createPrivateDataSet">false</Property>
                <Property name="dataSet">dsFreightEdit</Property>
                <Property name="visible">false</Property>
                <AutoFormElement>
                  <Property name="name">account</Property>
                  <Property name="property">account</Property>
                  <Property name="label">挂账</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">freightUnit</Property>
                  <Property name="property">freightUnit</Property>
                  <Property name="label">单价</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">driver</Property>
                  <Property name="property">driver</Property>
                  <Property name="label">司机名</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">driverPhone</Property>
                  <Property name="property">driverPhone</Property>
                  <Property name="label">司机电话</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">plateNum</Property>
                  <Property name="property">plateNum</Property>
                  <Property name="label">车牌号</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">unloadFee</Property>
                  <Property name="property">unloadFee</Property>
                  <Property name="label">卸车费</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">cleanFee</Property>
                  <Property name="property">cleanFee</Property>
                  <Property name="label">清理费</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">compensation</Property>
                  <Property name="property">compensation</Property>
                  <Property name="label">赔偿</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
            </Children>
            <Tools/>
          </Dialog>
          <UpdateAction id="updateactionEdit">
            <ClientEvent name="onFailure"> </ClientEvent>
            <ClientEvent name="onSuccess" signature="self,arg,dsStockRecord,dsStockSubrecord">var info = self.get(&quot;returnValue&quot;);&#xD;
if(info.result){&#xD;
	dsStockRecord.flush();&#xD;
	dsStockSubrecord.flush();&#xD;
	//dorado.MessageBox.alert(info.message);&#xD;
}else{&#xD;
	dorado.MessageBox.alert(info.message, {&#xD;
    icon: &quot;WARNING&quot;&#xD;
});&#xD;
}&#xD;
&#xD;
 </ClientEvent>
            <ClientEvent name="onGetUpdateData" signature="self,arg,dsRecordSave,dsSubrecordSave,dsFreightBill">var supplierId = view.get(&quot;#dsRecordSave.data:#.#supplierId&quot;);&#xD;
var matId = view.get(&quot;#dsRecordSave.data:#.#matId&quot;);&#xD;
&#xD;
&#xD;
&#xD;
self.set(&quot;parameter&quot;,{&#xD;
	&quot;supplierId&quot;:supplierId,&#xD;
	&quot;matId&quot; : matId&#xD;
	&#xD;
});</ClientEvent>
            <Property name="executingMessage">正在保存。。。</Property>
            <Property name="hotkey">ctrl+s</Property>
            <Property name="dataResolver">matStockService#updateSubRecord</Property>
            <UpdateItem>
              <Property name="dataSet">dsSubrecordEdit</Property>
            </UpdateItem>
          </UpdateAction>
        </Container>
      </MainControl>
      <SideControl>
        <Container>
          <DataGrid id="dgSubrecord">
            <Property name="dataSet">dsStockSubrecord</Property>
            <Property name="readOnly">true</Property>
            <Property name="height">200</Property>
            <Property name="selectionMode">none</Property>
            <Property name="dynaRowHeight">false</Property>
            <DataColumn name="matName">
              <Property name="property">matName</Property>
              <Property name="align">center</Property>
              <Property name="caption">组名</Property>
            </DataColumn>
            <DataColumn name="mat2Name">
              <Property name="property">mat2Name</Property>
              <Property name="align">center</Property>
              <Property name="caption">类别</Property>
            </DataColumn>
            <DataColumn name="mat3Name">
              <Property name="property">mat3Name</Property>
              <Property name="align">center</Property>
              <Property name="caption">品名</Property>
            </DataColumn>
            <DataColumn name="unit">
              <Property name="property">unit</Property>
              <Property name="align">center</Property>
              <Property name="caption">单位</Property>
            </DataColumn>
            <DataColumn name="count">
              <Property name="property">count</Property>
              <Property name="align">center</Property>
              <Property name="caption">数量</Property>
            </DataColumn>
            <DataColumn name="price">
              <Property name="property">price</Property>
              <Property name="align">center</Property>
              <Property name="caption">单价</Property>
            </DataColumn>
            <DataColumn name="subtotal">
              <Property name="property">subtotal</Property>
              <Property name="align">center</Property>
              <Property name="caption">小计</Property>
            </DataColumn>
            <DataColumn name="applicant">
              <Property name="property">applicant</Property>
              <Property name="align">center</Property>
              <Property name="caption">申请人</Property>
            </DataColumn>
            <DataColumn name="reviewState">
              <Property name="property">reviewState</Property>
              <Property name="align">center</Property>
              <Property name="caption">审核状态</Property>
            </DataColumn>
            <DataColumn name="checkState">
              <Property name="property">checkState</Property>
              <Property name="align">center</Property>
              <Property name="caption">验收状态</Property>
            </DataColumn>
          </DataGrid>
        </Container>
      </SideControl>
    </SplitPanel>
  </View>
</ViewConfig>
