DELIMITER $$

USE `xly`$$

DROP VIEW IF EXISTS `v_billrecord_fake`$$

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `v_billrecord_fake` AS 
SELECT
  `b`.`BILL_NO`        AS `billNo`,
  LPAD(`b`.`BILL_NO`,7,0) AS `billNoStr`,
  `b`.`BILL_TIME`      AS `billTime`,
  `b`.`BILL_TYPE`      AS `billType`,
  `b`.`CAR_NO`         AS `carNo`,
  `b`.`CREATER`        AS `creater`,
  `b`.`DRIVER_PHONE`   AS `driverPhone`,
  `b`.`FREIGHT`        AS `freight`,
  `b`.`REMARK`         AS `remark`,
  `b`.`STATE`          AS `bState`,
  `br`.`COUNT`         AS `count`,
  `br`.`PRICE`         AS `price`,
  `b`.`TOTAL_AMOUNT`   AS `totalAmount`,
  ((`br`.`COUNT` * `br`.`PRICE`) * `vs`.`QTY`) AS `subTotal`,
  `br`.`RECORD_ID`     AS `recordId`,
  `ctm`.`CTM_NAME`     AS `ctmName`,
  `ctm`.`CTM_ID`       AS `ctmId`,
  `ctm`.`ADDRESS`      AS `address`,
  `ctm`.`SALES_MGR_ID` AS `salesMgrId`,
  `vs`.`STOCK_ID`      AS `stockId`,
  `vs`.`WAREHOUSE`     AS `warehouse`,
  `vs`.`STATE`         AS `state`,
  `vs`.`STOCK`         AS `stock`,
  `vs`.`ID`            AS `id`,
  `vs`.`CATEGORT`      AS `categort`,
  `vs`.`COLOR`         AS `color`,
  `vs`.`PATTERN_NO`    AS `patternNo`,
  `vs`.`BRAND_NAME`    AS `brandName`,
  `vs`.`BRAND_ID`      AS `brandId`,
  `vs`.`GRADES_NAME`   AS `gradesName`,
  `vs`.`SPEC_ID`       AS `specId`,
  `vs`.`SPEC_NAME`     AS `specName`,
  `vs`.`TYPE_NAME`     AS `typeName`,
  `vs`.`QTY`           AS `qty`,
  (`br`.`COUNT` * `vs`.`QTY`) AS `qtyCount`,
  `vs`.`GRADES_ID`     AS `gradesId`,
  `vs`.`TYPE_ID`       AS `typeId`,
  `mgr`.`salesMgrName` AS `mgrName`
FROM ((((`xly_bill_fake` `b`
      JOIN `xly_bill_record_fake` `br`)
     JOIN `xly_customer` `ctm`)
    JOIN `v_mgr` `mgr`)
   JOIN `v_stock` `vs`)
WHERE ((`b`.`BILL_NO` = `br`.`BILL_NO`)
       AND (`b`.`CTM_ID` = `ctm`.`CTM_ID`)
       AND (`mgr`.`salesMgrId` = `ctm`.`SALES_MGR_ID`)
       AND (`br`.`STOCK_ID` = `vs`.`STOCK_ID`))
ORDER BY `b`.`BILL_NO` DESC$$

DELIMITER ;